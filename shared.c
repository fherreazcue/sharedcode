refactored from shared
added some bits
